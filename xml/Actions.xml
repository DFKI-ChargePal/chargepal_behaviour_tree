<root BTCPP_format="4">
  <BehaviorTree ID="action_arrive_station">
    <Fallback name="arrive_at_station">
      <RetryUntilSuccessful num_attempts="3"
                            _onSuccess="&quot;job_status=1&quot;">
        <arrive_at_station/>
      </RetryUntilSuccessful>
      <ForceFailure>
        <SubTree ID="recovery_aas"
                 _skipIf="!recovery_enabled"
                 _onSuccess="job_status=2"
                 _onFailure="job_status=3"
                 _autoremap="true"/>
      </ForceFailure>
      <ForceFailure>
        <call_for_help _skipIf="job_status==2"
                       _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="action_drop_cart">
    <Fallback name="drop_cart">
      <RetryUntilSuccessful num_attempts="3"
                            _onSuccess="job_status=1">
        <drop_cart/>
      </RetryUntilSuccessful>
      <ForceFailure>
        <SubTree ID="recovery_dc"
                 _skipIf="!recovery_enabled"
                 _onSuccess="job_status=2"
                 _onFailure="job_status=3"
                 _autoremap="true"/>
      </ForceFailure>
      <ForceFailure>
        <call_for_help _skipIf="job_status==2"
                       _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="action_go_home">
    <Fallback name="go_home">
      <RetryUntilSuccessful num_attempts="3"
                            _onSuccess="job_status=1">
        <go_home/>
      </RetryUntilSuccessful>
      <ForceFailure>
        <call_for_help _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="action_pickup_cart">
    <Fallback name="pickup_cart">
      <RetryUntilSuccessful num_attempts="3"
                            _onSuccess="job_status=1">
        <pickup_cart/>
      </RetryUntilSuccessful>
      <ForceFailure>
        <SubTree ID="recovery_pc"
                 _skipIf="!recovery_enabled"
                 _onSuccess="job_status=2"
                 _onFailure="job_status=3"
                 _autoremap="true"/>
      </ForceFailure>
      <ForceFailure>
        <call_for_help _skipIf="job_status==2"
                       _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="action_plugin">
    <Fallback name="plugin">
      <Sequence name="plugin_bcs">
        <isRobotAtBCS/>
        <Fallback name="plugin_bcs">
          <plugin_BCS _onSuccess="job_status=1"/>
          <ForceFailure>
            <SubTree ID="recovery_plugin"
                     _skipIf="!recovery_enabled"
                     _onSuccess="job_status=2"
                     _onFailure="job_status=3"
                     _autoremap="true"/>
          </ForceFailure>
        </Fallback>
      </Sequence>
      <Sequence name="plugin_ads">
        <isRobotAtADS/>
        <Fallback name="plugin_ads">
          <Sequence>
            <RetryUntilSuccessful num_attempts="5">
              <isReady2Plugin/>
            </RetryUntilSuccessful>
            <plugin_ADS _onSuccess="job_status=1"/>
          </Sequence>
          <ForceFailure>
            <SubTree ID="recovery_plugin"
                     _skipIf="!recovery_enabled"
                     _onSuccess="job_status=2"
                     _onFailure="job_status=3"
                     _autoremap="true"/>
          </ForceFailure>
        </Fallback>
      </Sequence>
      <ForceFailure>
        <call_for_help _skipIf="job_status==2"
                       _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="action_plugout">
    <Fallback name="plugout">
      <Sequence name="plugout_bcs">
        <isRobotAtBCS/>
        <Fallback name="plugout_bcs">
          <plugout_BCS _onSuccess="job_status=1"/>
          <ForceFailure>
            <SubTree ID="recovery_plugout"
                     _skipIf="!recovery_enabled"
                     _onSuccess="job_status=2"
                     _onFailure="job_status=3"
                     _autoremap="true"/>
          </ForceFailure>
        </Fallback>
      </Sequence>
      <Sequence name="plugout_ads">
        <isRobotAtADS/>
        <Fallback name="plugout_ads">
          <plugout_ADS _onSuccess="job_status=1"/>
          <ForceFailure>
            <SubTree ID="recovery_plugout"
                     _skipIf="!recovery_enabled"
                     _onSuccess="job_status=2"
                     _onFailure="job_status=3"
                     _autoremap="true"/>
          </ForceFailure>
        </Fallback>
      </Sequence>
      <ForceFailure>
        <call_for_help _skipIf="job_status==2"
                       _post="job_status=3"/>
      </ForceFailure>
    </Fallback>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Action ID="arrive_at_station"
            editable="true"/>
    <Action ID="call_for_help"
            editable="true"/>
    <Action ID="drop_cart"
            editable="true"/>
    <Action ID="go_home"
            editable="true"/>
    <Condition ID="isReady2Plugin"
               editable="true"/>
    <Condition ID="isRobotAtADS"
               editable="true"/>
    <Condition ID="isRobotAtBCS"
               editable="true"/>
    <Action ID="pickup_cart"
            editable="true"/>
    <Action ID="plugin_ADS"
            editable="true"/>
    <Action ID="plugin_BCS"
            editable="true"/>
    <Action ID="plugout_ADS"
            editable="true"/>
    <Action ID="plugout_BCS"
            editable="true"/>
  </TreeNodesModel>

</root>
