<root BTCPP_format="4">
  <BehaviorTree ID="recovery_aas">
    <IfThenElse>
      <isCartPlaced/>
      <Fallback>
        <go_home/>
        <call_for_help/>
      </Fallback>
      <Fallback>
        <Sequence>
          <isRobotAtBWS/>
          <recovery_arrive_BWS/>
        </Sequence>
        <Sequence>
          <isRobotAtBCS/>
          <Fallback>
            <recovery_arrive_BCS/>
            <Sequence>
              <recovery_arrive_BWS/>
              <go_home/>
            </Sequence>
          </Fallback>
        </Sequence>
        <Sequence>
          <isRobotAtADS/>
          <recovery_arrive_BWS/>
          <Fallback>
            <drop_cart/>
            <SubTree ID="recovery_dc"
                     _autoremap="true"/>
          </Fallback>
          <go_home/>
        </Sequence>
      </Fallback>
    </IfThenElse>
  </BehaviorTree>

  <BehaviorTree ID="recovery_dc">
    <Fallback>
      <Sequence>
        <isRobotAtBCS/>
        <recovery_arrive_BWS/>
        <drop_cart/>
        <go_home/>
      </Sequence>
      <Sequence>
        <isRobotAtADS/>
        <ReactiveFallback>
          <Sequence>
            <time_sleep/>
            <drop_cart/>
          </Sequence>
          <sleep_until_charged/>
        </ReactiveFallback>
        <Sequence>
          <isCartPlaced/>
          <go_home/>
        </Sequence>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="recovery_pc">
    <Sequence>
      <askAssertLift/>
      <go_home/>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="recovery_plugin">
    <Fallback>
      <Sequence>
        <isRobotAtBCS/>
        <set_arm_free_BCS/>
        <recovery_arrive_BWS/>
        <Fallback>
          <drop_cart/>
          <SubTree ID="recovery_dc"
                   _autoremap="true"/>
        </Fallback>
        <go_home/>
      </Sequence>
      <Sequence>
        <isRobotAtADS/>
        <set_arm_free_ADS/>
        <recovery_arrive_BWS/>
        <Fallback>
          <RetryUntilSuccessful num_attempts="3">
            <drop_cart/>
          </RetryUntilSuccessful>
          <SubTree ID="recovery_dc"
                   _autoremap="true"/>
        </Fallback>
        <go_home/>
      </Sequence>
    </Fallback>
  </BehaviorTree>

  <BehaviorTree ID="recovery_plugout">
    <Sequence>
      <IfThenElse>
        <isRobotAtBCS/>
        <set_arm_free_BCS/>
        <set_arm_free_ADS/>
      </IfThenElse>
      <Fallback>
        <drop_cart/>
        <SubTree ID="recovery_dc"
                 _autoremap="true"/>
      </Fallback>
      <go_home/>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Condition ID="askAssertLift"
               editable="true"/>
    <Action ID="call_for_help"
            editable="true"/>
    <Action ID="drop_cart"
            editable="true"/>
    <Action ID="go_home"
            editable="true"/>
    <Condition ID="isCartPlaced"
               editable="true"/>
    <Condition ID="isRobotAtADS"
               editable="true"/>
    <Condition ID="isRobotAtBCS"
               editable="true"/>
    <Condition ID="isRobotAtBWS"
               editable="true"/>
    <Action ID="recovery_arrive_BCS"
            editable="true"/>
    <Action ID="recovery_arrive_BWS"
            editable="true"/>
    <Action ID="set_arm_free_ADS"
            editable="true"/>
    <Action ID="set_arm_free_BCS"
            editable="true"/>
    <Action ID="sleep_until_charged"
            editable="true"/>
    <Action ID="time_sleep"
            editable="true"/>
  </TreeNodesModel>

</root>
