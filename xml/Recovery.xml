<root BTCPP_format="4">
  <BehaviorTree ID="recovery_aas">
    <Sequence>
      <error_count/>
      <RetryUntilSuccessful num_attempts="3">
        <delete_mir_mission_queue/>
      </RetryUntilSuccessful>
      <IfThenElse>
        <isCartPlaced/>
        <Fallback>
          <RetryUntilSuccessful num_attempts="3">
            <go_home/>
          </RetryUntilSuccessful>
          <call_for_help/>
        </Fallback>
        <Fallback>
          <Sequence>
            <isRobotAtBWS/>
            <recovery_arrive_BWS/>
          </Sequence>
          <Sequence>
            <isRobotAtBCS/>
            <Fallback>
              <recovery_arrive_BCS/>
              <Sequence>
                <recovery_arrive_BWS/>
                <go_home/>
              </Sequence>
            </Fallback>
          </Sequence>
          <Sequence>
            <isRobotAtADS/>
            <recovery_arrive_BWS/>
            <Fallback>
              <RetryUntilSuccessful num_attempts="3">
                <drop_cart/>
              </RetryUntilSuccessful>
              <SubTree ID="recovery_dc"
                       _autoremap="true"/>
            </Fallback>
            <RetryUntilSuccessful num_attempts="3">
              <go_home/>
            </RetryUntilSuccessful>
          </Sequence>
        </Fallback>
      </IfThenElse>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="recovery_dc">
    <Sequence>
      <error_count/>
      <RetryUntilSuccessful num_attempts="3">
        <delete_mir_mission_queue/>
      </RetryUntilSuccessful>
      <Fallback>
        <Sequence>
          <isRobotAtBCS/>
          <recovery_arrive_BWS/>
          <RetryUntilSuccessful num_attempts="3">
            <drop_cart/>
          </RetryUntilSuccessful>
          <RetryUntilSuccessful num_attempts="3">
            <go_home/>
          </RetryUntilSuccessful>
        </Sequence>
        <Sequence>
          <isRobotAtADS/>
          <ReactiveFallback>
            <Sequence>
              <time_sleep/>
              <RetryUntilSuccessful num_attempts="3">
                <drop_cart/>
              </RetryUntilSuccessful>
            </Sequence>
            <sleep_until_charged/>
          </ReactiveFallback>
          <Sequence>
            <isCartPlaced/>
            <RetryUntilSuccessful num_attempts="3">
              <go_home/>
            </RetryUntilSuccessful>
          </Sequence>
        </Sequence>
      </Fallback>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="recovery_pc">
    <Sequence>
      <error_count/>
      <RetryUntilSuccessful num_attempts="3">
        <delete_mir_mission_queue/>
      </RetryUntilSuccessful>
      <askAssertLift/>
      <RetryUntilSuccessful num_attempts="3">
        <go_home/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="recovery_plugin">
    <Sequence>
      <error_count/>
      <isArmFree/>
      <recovery_arrive_BWS/>
      <Fallback>
        <RetryUntilSuccessful num_attempts="3">
          <drop_cart/>
        </RetryUntilSuccessful>
        <SubTree ID="recovery_dc"
                 _autoremap="true"/>
      </Fallback>
      <RetryUntilSuccessful num_attempts="3">
        <go_home/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="recovery_plugout">
    <Sequence>
      <error_count/>
      <isArmFree/>
      <Fallback>
        <RetryUntilSuccessful num_attempts="3">
          <drop_cart/>
        </RetryUntilSuccessful>
        <SubTree ID="recovery_dc"
                 _autoremap="true"/>
      </Fallback>
      <RetryUntilSuccessful num_attempts="3">
        <go_home/>
      </RetryUntilSuccessful>
    </Sequence>
  </BehaviorTree>

  <!-- Description of Node Models (used by Groot) -->
  <TreeNodesModel>
    <Condition ID="askAssertLift"
               editable="true"/>
    <Action ID="call_for_help"
            editable="true"/>
    <Action ID="delete_mir_mission_queue"
            editable="true"/>
    <Action ID="drop_cart"
            editable="true"/>
    <Action ID="error_count"
            editable="true"/>
    <Action ID="go_home"
            editable="true"/>
    <Condition ID="isArmFree"
               editable="true"/>
    <Condition ID="isCartPlaced"
               editable="true"/>
    <Condition ID="isRobotAtADS"
               editable="true"/>
    <Condition ID="isRobotAtBCS"
               editable="true"/>
    <Condition ID="isRobotAtBWS"
               editable="true"/>
    <Action ID="recovery_arrive_BCS"
            editable="true"/>
    <Action ID="recovery_arrive_BWS"
            editable="true"/>
    <Action ID="sleep_until_charged"
            editable="true"/>
    <Action ID="time_sleep"
            editable="true"/>
  </TreeNodesModel>

</root>
